---
title: 阻塞队列异步消费怎么保持顺序
date: 2023-08-09 20:26:22
categories:
- 阻塞队列
tags:
- 异步消费
- 保持顺序
---
这个问题需要从三个方面来回答。

首先，阻塞队列本身是符合FIFO特性的队列，也就是存储进去的元素符合先进先出的规则。

其次，在阻塞队列里面，使用condition条件等待来维护了两个等待队列，一个是队列为空的时候存储被阻塞的消费者，另一个是队列满了的时候存储被阻塞的生产者并且存储在等待队列里面的线程，都符合FIFO的特性。

最后，对于阻塞队列的消费过程，有两种情况。

* 第一种，就是阻塞队列里面已经包含了很多任务，这个时候启动多个消费者去消费的时候，它的有序性保证是通过加锁来实现的，也就是每个消费者线程去阻塞队列获取任务的时候必须要先获取排它锁。
* 第二种，如果有多个消费者线程因为阻塞队列中没有任务而阻塞，这个时候这些线程是按照FIFO的顺序存储到condition条件等待队列中的，当阻塞队列中开始有任务要处理的时候，这些被阻塞的消费者线程会严格按照FIFO的顺序来唤醒，从而保证了消费的顺序性。